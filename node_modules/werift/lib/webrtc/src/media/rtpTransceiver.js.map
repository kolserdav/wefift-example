{"version":3,"file":"rtpTransceiver.js","sourceRoot":"","sources":["../../../../src/media/rtpTransceiver.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,sDAA4B;AAC5B,2CAA6B;AAG7B,oCAA4C;AAU5C,MAAa,iBAAiB;IA+B5B,YACkB,IAAU,EAC1B,aAA+B,EACxB,QAAwB,EACxB,MAAoB;IAC3B,qEAAqE;IAC9D,SAAoB;QALX,SAAI,GAAJ,IAAI,CAAM;QAEnB,aAAQ,GAAR,QAAQ,CAAgB;QACxB,WAAM,GAAN,MAAM,CAAc;QAEpB,cAAS,GAAT,SAAS,CAAW;QApCpB,SAAI,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC;QACjB,YAAO,GAAG,IAAI,iBAAK,EAAsB,CAAC;QAGnD,kBAAa,GAAG,KAAK,CAAC;QActB,YAAO,GAA4B,EAAE,CAAC;QAOtC,qBAAgB,GAAsC,EAAE,CAAC;QACzD,YAAO,GAAgC,EAAE,CAAC;QAC1C,aAAQ,GAAG,KAAK,CAAC;QACjB,YAAO,GAAG,KAAK,CAAC;QAUd,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC;IACvC,CAAC;IAjCD,IAAI,gBAAgB,CAAC,SAA4C;QAC/D,IAAI,CAAC,iBAAiB,GAAG,SAAS,CAAC;QACnC,IAAI,wBAAgB,CAAC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,IAAI,EAAE,CAAC,EAAE;YAC3D,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;SAC3B;IACH,CAAC;IACD,+CAA+C;IAC/C,IAAI,gBAAgB;QAClB,OAAO,IAAI,CAAC,iBAAiB,CAAC;IAChC,CAAC;IAID,IAAI,MAAM,CAAC,MAA+B;QACxC,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;IACxB,CAAC;IACD,IAAI,MAAM;QACR,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAiBD,IAAI,aAAa;QACf,OAAO,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC;IACrC,CAAC;IAED,gBAAgB,CAAC,IAAsB;QACrC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;QACrC,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;IACrC,CAAC;IAED,IAAI,IAAI;QACN,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;IAC1D,CAAC;IAED,QAAQ,CAAC,KAAuB;QAC9B,MAAM,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAC1C,IAAI,GAAG;YAAE,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IACvC,CAAC;IAED,YAAY;IACZ,0CAA0C;IAC1C,IAAI;QACF,IAAI,IAAI,CAAC,QAAQ;YAAE,OAAO;QAE1B,oDAAoD;QAEpD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;IACvB,CAAC;IAED,cAAc,CAAC,QAAgB;QAC7B,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAChC,KAAK,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAC9D,EAAE,WAAW,CAAC;IACjB,CAAC;CACF;AA3ED,8CA2EC;AAEY,QAAA,UAAU,GAAG;IACxB,UAAU;IACV,UAAU;IACV,UAAU;IACV,UAAU;CACF,CAAC","sourcesContent":["import Event from \"rx.mini\";\nimport * as uuid from \"uuid\";\n\nimport { RTCDtlsTransport } from \"..\";\nimport { SenderDirections } from \"../const\";\nimport { Kind } from \"../types/domain\";\nimport {\n  RTCRtpCodecParameters,\n  RTCRtpHeaderExtensionParameters,\n} from \"./parameters\";\nimport { RTCRtpReceiver } from \"./rtpReceiver\";\nimport { RTCRtpSender } from \"./rtpSender\";\nimport { MediaStreamTrack } from \"./track\";\n\nexport class RTCRtpTransceiver {\n  readonly uuid = uuid.v4();\n  readonly onTrack = new Event<[MediaStreamTrack]>();\n  mid?: string;\n  mLineIndex?: number;\n  usedForSender = false;\n  private _currentDirection?: Direction | \"stopped\";\n  set currentDirection(direction: Direction | \"stopped\" | undefined) {\n    this._currentDirection = direction;\n    if (SenderDirections.includes(this._currentDirection || \"\")) {\n      this.usedForSender = true;\n    }\n  }\n  /**RFC 8829 4.2.5. last negotiated direction */\n  get currentDirection(): Direction | \"stopped\" | undefined {\n    return this._currentDirection;\n  }\n\n  offerDirection!: Direction;\n  _codecs: RTCRtpCodecParameters[] = [];\n  set codecs(codecs: RTCRtpCodecParameters[]) {\n    this._codecs = codecs;\n  }\n  get codecs() {\n    return this._codecs;\n  }\n  headerExtensions: RTCRtpHeaderExtensionParameters[] = [];\n  options: Partial<TransceiverOptions> = {};\n  stopping = false;\n  stopped = false;\n\n  constructor(\n    public readonly kind: Kind,\n    dtlsTransport: RTCDtlsTransport,\n    public receiver: RTCRtpReceiver,\n    public sender: RTCRtpSender,\n    /**RFC 8829 4.2.4.  direction the transceiver was initialized with */\n    public direction: Direction\n  ) {\n    this.setDtlsTransport(dtlsTransport);\n  }\n\n  get dtlsTransport() {\n    return this.receiver.dtlsTransport;\n  }\n\n  setDtlsTransport(dtls: RTCDtlsTransport) {\n    this.receiver.setDtlsTransport(dtls);\n    this.sender.setDtlsTransport(dtls);\n  }\n\n  get msid() {\n    return `${this.sender.streamId} ${this.sender.trackId}`;\n  }\n\n  addTrack(track: MediaStreamTrack) {\n    const res = this.receiver.addTrack(track);\n    if (res) this.onTrack.execute(track);\n  }\n\n  // todo impl\n  // https://www.w3.org/TR/webrtc/#methods-8\n  stop() {\n    if (this.stopping) return;\n\n    // todo Stop sending and receiving with transceiver.\n\n    this.stopping = true;\n  }\n\n  getPayloadType(mimeType: string) {\n    return this.codecs.find((codec) =>\n      codec.mimeType.toLowerCase().includes(mimeType.toLowerCase())\n    )?.payloadType;\n  }\n}\n\nexport const Directions = [\n  \"inactive\",\n  \"sendonly\",\n  \"recvonly\",\n  \"sendrecv\",\n] as const;\n\nexport type Direction = typeof Directions[number];\n\ntype SimulcastDirection = \"send\" | \"recv\";\n\nexport interface TransceiverOptions {\n  direction: Direction;\n  simulcast: { direction: SimulcastDirection; rid: string }[];\n}\n"]}