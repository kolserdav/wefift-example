"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.findPort = exports.randomPorts = exports.randomPort = void 0;
const dgram_1 = require("dgram");
async function randomPort(protocol = "udp4") {
    const socket = (0, dgram_1.createSocket)(protocol);
    setImmediate(() => socket.bind(0));
    await new Promise((r) => {
        socket.once("error", r);
        socket.once("listening", r);
    });
    const port = socket.address()?.port;
    await new Promise((r) => socket.close(() => r()));
    return port;
}
exports.randomPort = randomPort;
async function randomPorts(num, protocol = "udp4") {
    return Promise.all([...Array(num)].map(() => randomPort(protocol)));
}
exports.randomPorts = randomPorts;
async function findPort(min, max, protocol = "udp4") {
    let port;
    for (let i = min; i <= max; i++) {
        const socket = (0, dgram_1.createSocket)(protocol);
        setImmediate(() => socket.bind(i));
        await new Promise((r) => {
            socket.once("error", r);
            socket.once("listening", r);
        });
        port = socket.address()?.port;
        await new Promise((r) => socket.close(() => r()));
        if (min <= port && port <= max) {
            break;
        }
    }
    if (!port)
        throw new Error("port not found");
    return port;
}
exports.findPort = findPort;
//# sourceMappingURL=network.js.map